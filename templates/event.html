<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Event Monitor</title>

    <!-- CSS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/event.css') }}">
</head>
<body>

<div class="container">
    <header class="header">
        <h1>üìã EventSquare ‚Äì Check-in Monitor</h1>
    </header>

    <!-- Event Info -->
    <section class="card">
        <div class="event-info">
            <div>
                <span class="label">Event name</span>
                <span class="value">{{ event.name }}</span>
            </div>
            <div>
                <span class="label">Event ID</span>
                <span class="value mono">{{ event_id }}</span>
            </div>
        </div>
    </section>

    <!-- Log -->
    <section class="card log-card">
        <h3>üïí Log ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå</h3>
        <ul id="logList" class="log-list">
            <li class="empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ log</li>
        </ul>
    </section>

    <!-- Raw Response -->
    <section class="card">
        <h3>üì¶ Response ‡∏à‡∏≤‡∏Å Server</h3>
        <pre id="result">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</pre>
    </section>
</div>


<script>
const eventId = "{{ event_id }}";
const logList = document.getElementById("logList");
const resultBox = document.getElementById("result");

async function fetchLogs() {
    const res = await fetch(`/events/logs/${eventId}`);
    const logs = await res.json();

    logList.innerHTML = "";

    if (logs.length === 0) {
        logList.innerHTML = `<li class="empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ log</li>`;
        return;
    }

    logs.forEach(log => {
        const li = document.createElement("li");
        li.textContent = log;
        logList.appendChild(li);
    });

    resultBox.textContent = JSON.stringify(logs[logs.length - 1], null, 2);
}

setInterval(fetchLogs, 1000);
fetchLogs();
</script>
</body>
</html>